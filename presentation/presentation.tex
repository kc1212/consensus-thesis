% TU Delft beamer template
% Author: Erwin Walraven (initial version was created by Maarten Abbink)
% Delft Universiy of Technology

\documentclass{beamer}
\usepackage[english]{babel}
\usepackage{calc}
\usepackage[absolute,overlay]{textpos}
\usepackage{graphicx}
\graphicspath{{./figures/}{../figures/}}
\usepackage{subfig}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amsthm}
\usepackage{mathtools}
\usepackage{comment}
\usepackage{MnSymbol,wasysym}
\usepackage[noend]{algpseudocode}
\usepackage{algorithm}
\usepackage{makecell}
\usepackage[style=ieee]{biblatex}
\addbibresource{references.bib}

\setbeamertemplate{navigation symbols}{} % remove navigation symbols
\mode<presentation>{\usetheme{tud}}

\newcommand{\A}{\mathcal{A}}
\newcommand{\C}{\mathcal{C}}
\renewcommand{\P}{\mathcal{P}}
\newcommand{\F}{\mathcal{F}}
\newcommand{\E}{\mathcal{E}}

\algnewcommand\algorithmicupon{\textbf{Upon}}
\algnewcommand\Upon{\item[\algorithmicupon]}

\algnewcommand\algorithmicsend{\textbf{Send}}
\algnewcommand\Send{\item[\algorithmicsend]}

% \setbeameroption{show notes}

\title{Blockchain Consensus Protocol with\\Horizontal Scalability}
% \subtitle{Optional Subtitle}

\author{K.~Cong}
% - Give the names in the same order as the appear in the paper.
% - Use the \inst{?} command only if the authors have different
%   affiliation.

\institute[Delft University of Technology] % (optional, but mostly needed)
{
  Faculty of Electrical Engineering, Mathematics and Computer Science\\
  Delft University of Technology}
% - Use the \inst command only if there are several affiliations.
% - Keep it simple, no one is interested in your street address.

% \date{Conference Name, 2013}
\date{\today}

\AtBeginSubsection[] % Do nothing for \subsection*
{
  % do nothing
}

\AtBeginSection[] % Do nothing for \section*
{
  \begin{frame}<beamer>
  \frametitle{Outline}
  \tableofcontents[currentsection]
  \end{frame}
}


% Let's get started
\begin{document}

\begin{frame}
  \titlepage

\end{frame}

\begin{frame}{Outline}
  \tableofcontents[]
  % You might wish to add the option [pausesections]
\end{frame}

% Section and subsections will appear in the presentation overview
% and table of contents.
\section{Introduction}
\subsection{The dangers of centralisation}
\begin{frame}{The dangers of centralisation}
  \begin{itemize}
    \item Technological advancements give us convenience
    \item But it puts central authorities in control
    \item Many are motivated by profit
    \item Not always in the interest of the ``users''\footnote{Typically users of some free service X are, in fact, used by X.}
  \end{itemize}
\end{frame}

\begin{frame}{The dangers of centralisation:~Examples}
  \begin{itemize}
    \item Baidu's promoted search result on experimental medical care caused death of a student~\cite{weizexi}
    \item Facebook can predict your opinions and desires better than your spouse~\cite{youyou2015computer}
    \item With intimate knowledge of the individuals,
      Facebook creates ``psychographic'' profiles in political campaigns~\cite{psychographic}
  \end{itemize}
  \note{
    \begin{itemize}
      \item The student had cancer---(synovial sarcoma)
      \item The treatment was phased out at clinical stage in the US because the success rate is too low
      \item ``The study was conducted on 86,220 volunteers who have a Facebook account and who
      completed a hundred-item personality questionnaire. The Facebook algorithm predicted the volunteers'
      answers based on monitoring their Facebook Likes â€“ which webpages, images and clips they tagged with the
      Like button. The more Likes, the more accurate the predictions. The algorithm's predictions were compared
      with those of work colleagues, friends, family members and spouses. Amazingly, the algorithm needed a set
      of only ten Likes in order to outperform the predictions of work colleagues. It needed seventy Likes to
      outperform friends, 150 Likes to outperform family members and 300 Likes to outperform spouses. In other
      words, if you happen to have clicked 300 Likes on your Facebook account, the Facebook algorithm can
      predict your opinions and desires better than your husband or wife!'' -Harari, \emph{Homo Deus}
      \item Summary: we live in an age where companies and governments are able to control our thoughts,
      where is the freedom and liberty in that?
    \end{itemize}
  }
\end{frame}


\begin{frame}{Blockchain:~a new hope?}
  \begin{itemize}
    \item Blockchains are distributed ledgers
    \item They enable large scale consensus
    \item An alternative to central authorities for the first time
    \item Some applications include:
    \begin{itemize}
      \item Digital cash (e.g., Bitcoin)
      \item Domain name system (e.g., Namecoin)
      \item File sharing (e.g., Filecoin)
      \item General purpose (e.g., Ethereum)
    \end{itemize}
  \end{itemize}
  \note{
    \begin{itemize}
      \item Explain blockchain systems---consensus
    \end{itemize}
  }
\end{frame}

\begin{frame}{Blockchain:~not there yet}
  \begin{itemize}
    \item Early blockchain systems do not scale
    \item Bitcoin is limited to 7 transactions per second
    \item 100,000 transaction backlog in May 2017
    \item We require horizontal scalability for ubiquitous use
    \item More nodes = better performance and throughput
  \end{itemize}
\end{frame}

\subsection{Related work}
\begin{frame}{Related work}
  \begin{table}[htb]
    \centering
    \caption{Summary of the scalability properties of many blockchain systems.
    Scalability gets better from left to right.}
    \label{tab:scalability}
    \begin{tabular}{|l|l|l|l|}
    \hline
    \textbf{\thead{Not\\scalable}} & \textbf{\thead{Somewhat\\scalable}} & \textbf{\thead{Limited horizontal\\scalability}} & \textbf{\thead{True horizontal\\scalability}} \\ \hline
    Bitcoin  & Hyperledger & Elastico          & \textsc{Checo} (this work) \\
    Ethereum & ByzCoin     & OmniLedger        &                \\
    etc.     & Solidius    & Lightning Network &                \\
    \hline
    \end{tabular}
\end{table}
\end{frame}

\begin{frame}{Related work}
  State-of-the-art: Sharding
  \begin{itemize}
  \item Split state into multiple shards
  \item Shards run consensus algorithm in parallel
  \item Difficult to perform atomic inter-shard transactions
    \begin{itemize}
      \item Elastico: not possible
      \item OmniLedger: via Atomic Commit protocol
    \end{itemize}
  \item Additional complexity
  \item Diminishing return
  \end{itemize}
\end{frame}

\subsection{Research question}
\begin{frame}{\subsecname}
  \begin{block}{}
    \Large{
    How can we design a \emph{blockchain consensus protocol} that is \emph{fault tolerant},
    \emph{scalable} and able to reach \emph{global consensus?}
    }
  \end{block}
    \note{
      \begin{itemize}
      \item Blockchain consensus protocol---independent of the application, like PoW (not PoS)
      \item Byzantine fault tolerance---if some number of nodes are malicious then the system should continue to function
      \item Horizontal scalability---if every node make transactions at the same rate, then the global throughput should increase
      \item Global consensus---all node should agree on a global state, useful for some applications, e.g. digital cash
      \end{itemize}
    }
\end{frame}

\section{System architecture}
\begin{frame}{Intuition}
  \begin{itemize}
    \item Traditionally: to reach consensus and check the validity of all transactions is expensive
    \item Our idea: we decouple consensus and validation
    \item Use a single digest to represent an arbitrarily large number of transactions
    \item Reach consensus on the small digest
    \item Nodes then independently check the validity of the transactions of interest
  \end{itemize}
\end{frame}

\subsection{System model}
\begin{frame}{\subsecname}
  \begin{itemize}
    \item $N$ is the population size
    \item Purely asynchronous channels with eventual delivery
    \item $n$ nodes are facilitators
    \item $t$ nodes are malicious, i.e. Byzantine
    \item $n \ge 3t + 1$
    \item $N \ge n + t$
  \end{itemize}
  \note{At this point, explain facilitators are nodes that have some extra task to do, temporarily.
  Explain that $N$ is typically a lot larger than $n$ instead of explaining $N \ge n + t$.}
\end{frame}

\subsection{Architecture overview}
\begin{frame}{\subsecname}
  \begin{center}
  \Large{The four components of \textsc{Checo}}
  \begin{figure}[h]
  \includegraphics[width=0.7\textwidth]{architecture-wo-title}
  \centering
  \end{figure}
  \end{center}
  \note{
    \begin{itemize}
    \item The primary data structure is the Extended TrustChain, extension of our prior work
    \item The three protocols the tasks as their name suggests
    \item They are independent and run concurrently
    \item The only synchronisation happens via the Extended TrustChain
    \item But in no part of those protocol do we lock the Extended TrustChain
    \end{itemize}
  }
\end{frame}

\subsection{Extended TrustChain}
\begin{frame}{\subsecname}
  \begin{figure}[h]
  \includegraphics[width=0.75\textwidth]{trustchain-good-cp}
  \centering
  \end{figure}
  \note{
    \begin{itemize}
      \item In this example there are three nodes
      \item Squares are TX blocks and circles are CP blocks
      \item Explain the block content in caption
      \item The dotted line represent pairs of TX blocks
      \item Geared with the understanding of our data structure, we are ready to talk about the consensus protocol
    \end{itemize}
  }
\end{frame}

\begin{frame}{\subsecname:~TX block}
  \begin{enumerate}
    \item Hash pointer to the previous block
    \item Sequence number
    \item Transaction ID
    \item Public key of the counterparty
    \item Transaction message $m$
    \item Signature the five items above
  \end{enumerate}
  \vfill
  A transaction is represented by a \emph{pair} of TX blocks
\end{frame}

\begin{frame}{\subsecname:~CP block}
  \begin{enumerate}
    \item Hash pointer to the previous block
    \item Sequence number
    \item Digest of consensus result, i.e.~a set of CP blocks
    \item Round number $r$
    \item Signature on the four items above
  \end{enumerate}
\end{frame}

\begin{frame}{\subsecname:~Fragment of a TX block}
  \begin{figure}[h]
  \includegraphics[width=0.75\textwidth]{trustchain-good-cp-frag}
  \centering
  \end{figure}
\end{frame}

\subsection{Consensus protocol}

\begin{frame}{\subsecname---Background on ACS}
  \begin{itemize}
    \item Asynchronous common subset
    \item A simplification of HoneyBadgerBFT~\cite{miller2016honey}
    \item $n$ nodes
    \item $t$ nodes may be malicious
    \item Input: every node proposes a set of values, e.g., $\{A, B\}, \{B, C\}, \dots$
    \item Output: set union of the majority, e.g., $\{A, B, C, \dots \}$
  \end{itemize}
\end{frame}

\begin{frame}{\subsecname}
  \begin{figure}[h]
  \includegraphics[trim={2cm 1.5cm 2cm 1.5cm},clip,width=0.75\textwidth]{trustchain-1}
  \centering
  \end{figure}
  \note{Suppose we are in a state where $\C_{r - 1}$ has just been agreed by some facilitators but not yet propagated.}
\end{frame}

\begin{frame}{\subsecname}
  \begin{figure}[h]
  \includegraphics[trim={2cm 1.5cm 2cm 1.5cm},clip,width=0.75\textwidth]{trustchain-2}
  \centering
  \end{figure}
  \note{Nodes receive consensus result $\C_{r - 1}$,
    first $n$ nodes ordered by $\textsf{H}(\C_{r-1} || pk)$ become $\F_{r-1}$,
    send the new CP blocks to $\F_{r-1}$.}
\end{frame}

\begin{frame}{\subsecname}
  \begin{figure}[h]
  \includegraphics[trim={2cm 1.5cm 2cm 1.5cm},clip,width=0.75\textwidth]{trustchain-3}
  \centering
  \end{figure}
\end{frame}

\begin{frame}{\subsecname}
  \begin{figure}[h]
  \includegraphics[trim={2cm 1.5cm 2cm 1.5cm},clip,width=0.75\textwidth]{trustchain-4}
  \centering
  \end{figure}
\end{frame}

\begin{frame}{\subsecname}
  \begin{figure}[h]
  \includegraphics[trim={2cm 1.5cm 2cm 1.5cm},clip,width=0.75\textwidth]{trustchain-5}
  \centering
  \end{figure}
  \note{Transactions carry on as usual in round $r$,
  while facilitators are trying to reach consensus on the new CP blocks concurrently.}
\end{frame}

\begin{frame}{\subsecname}
  \begin{figure}[h]
  \includegraphics[trim={2cm 1.5cm 2cm 1.5cm},clip,width=0.75\textwidth]{trustchain-6}
  \centering
  \end{figure}
  \note{$\F_{r-1}$ agree and disseminate $\C_r$,
  CP blocks at round $r-1$ ($c_{a, 6}, c_{b, 4}, c_{c,8}$) should be in $\C_r$.}
\end{frame}

\begin{frame}{\subsecname:~properties}
\label{def:consensus}
The consensus protocol has the following properties in every round $r$.
\begin{enumerate}
    \item \emph{Agreement}:
        Every correct outputs the same set of facilitators.
    \item \emph{Validity}:
      The consensus results is valid such that a new set of facilitators can be computed from it.
    \item \emph{Fairness}:
        Every node with a CP block in the consensus result should have an equal probability of becoming a facilitator.
    \item \emph{Termination}:
        Every correct node eventually outputs a set of facilitators.
\end{enumerate}
\end{frame}

\subsection{Transaction protocol}
\begin{frame}{\subsecname}
  \begin{figure}[h]
  \includegraphics[width=1.0\textwidth]{tx-proto}
  \centering
  \end{figure}
\begin{itemize}
\item Request and response protocol
\item Two TX blocks containing the same $txid$ are generated
\item Non-blocking
\end{itemize}
\end{frame}

\subsection{Validation protocol}
\begin{frame}{\subsecname}
  \begin{figure}[h]
  \includegraphics[width=1.0\textwidth]{vd-proto}
  \centering
  \end{figure}
\begin{itemize}
\item Alice needs the two fragments that belong to the transaction
\item Validation function checks whether the fragments are OK and contain the transaction
\item Non-blocking
\end{itemize}
\end{frame}

\begin{frame}{\subsecname:~properties}
\begin{itemize}
  \item CP blocks of the fragments are ``anchored'' due to the consensus protocol
  \item It is difficult to modify the fragment once ``anchored''
  \item Implicit consensus on transactions via CP blocks
\end{itemize}
\end{frame}

\section{Experimental results}
\begin{frame}{Implementation and experiment setup}
  \begin{itemize}
    \item Free and open source implementation on Github:
      \url{https://github.com/kc1212/checo}
    \item SHA256 for hash functions and Ed25519 for digital signature
    \item Experiment on the DAS-5\footnote{\url{http://www.cs.vu.nl/das5/}}
  \end{itemize}
\end{frame}

\begin{frame}{Throughput vs population size (random neighbour)}
  \begin{figure}[h]
  \includegraphics[width=0.9\textwidth]{neighbour-random/throughput-vs-population}
  \centering
  \end{figure}
\end{frame}

\begin{frame}{Throughput vs population size (fixed neighbour)}
  \begin{figure}[h]
  \includegraphics[width=0.9\textwidth]{neighbour-fixed/throughput-vs-population}
  \centering
  \end{figure}
\note{No need to request for fragment every time a TX needs to be validated. Upon receiving a fragment, validate as many TX as possible.}
\end{frame}

\section{Conclusion}
\begin{frame}{\secname}
  \begin{block}{Research question}
    How can we design a \emph{blockchain consensus protocol} that is \emph{fault tolerant},
    \emph{scalable} and able to reach \emph{global consensus?}
  \end{block}
Our system achieve the following
\begin{itemize}
  \item Fault tolerant up to $t$ nodes
  \item Horizontal scalability
  \item Global consensus on CP blocks
\end{itemize}
\end{frame}

\begin{frame}{Future work}
\begin{itemize}
\item Improve fault tolerance
\item Improve fork detection
\item Analyse the system in the permissionless environment
\item Concrete application
\end{itemize}
\end{frame}

\begin{frame}{Bibliography}
\printbibliography
\end{frame}

\section*{Extras}
\end{document}


% Sybils
% facilitator set?
% incentivise?
% attack (predict) of facilitator
% appoint facilitator
% liveness / non-responsive / slow
% drawbacks
% 